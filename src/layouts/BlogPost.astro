---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import BlogComment from '../components/BlogComment.astro';

export interface LayoutProps {
	title?: string;
	description?: string;
	pubDate?: Date | string;
	updatedDate?: Date | string;
	heroImage?: string;
	postSlug?: string;
}

const { title = '', description = '', pubDate, updatedDate, heroImage, postSlug } = Astro.props as LayoutProps;
const pageUrl = Astro.site ? new URL(Astro.url.pathname, Astro.site).toString() : '';
const pageId = postSlug || Astro.url.pathname.replace(/\/$/, '');
---
<html lang="en">
	<head>
		<BaseHead title={title} description={description} />
		<style>
			/* Layout container */
			main { width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 1rem; box-sizing: border-box; }
			.hero-image { width: 100%; margin: 0 auto 1rem auto; }
			.hero-image img { display: block; width: 100%; height: auto; border-radius: 12px; box-shadow: var(--box-shadow); }
			.prose { max-width: 820px; width: 100%; margin: 0 auto 2rem auto; padding: 1rem; box-sizing: border-box; color: rgb(var(--gray-dark)); line-height: 1.65; }
			.title { margin-bottom: 1em; padding: 1em 0 0.5em 0; text-align: center; line-height: 1.1; }
			.title h1 { margin: 0 0 0.5em 0; font-size: clamp(1.6rem, 2.4vw, 2.6rem); }
			.title .post-description { margin: 0.25rem auto 0; max-width: 60ch; font-size: clamp(.9rem, .7rem + .4vw, 1.05rem); line-height:1.45; color: rgb(var(--gray)); }
			body.dark .title .post-description { color: #b8c3d4; }
			.date { margin-bottom: 0.5em; color: rgb(var(--gray)); }
			.last-updated-on { font-style: italic; }
			.prose img, .prose picture, .prose video { max-width: 100%; height: auto; display: block; margin: 0.75rem auto; }
			.video-wrap { position: relative; width: 100%; max-width: 900px; padding-bottom: 56.25%; height: 0; overflow: hidden; margin: 0.75rem auto; }
			.video-wrap iframe, .video-wrap video, .video-wrap embed, .video-wrap object { position: absolute; top:0; left:0; width:100%; height:100%; border:0; }
			.prose table { width: 100%; border-collapse: collapse; margin: 1rem 0; overflow: auto; display: block; }
			.prose table th, .prose table td { padding: 0.5rem 0.75rem; text-align: left; }
			.prose pre { overflow: auto; border-radius: 8px; padding: 0.75rem 1rem; background: rgba(var(--black), 0.03); margin: 1rem 0; }
			.prose code { word-break: break-word; }
			.prose a { color: var(--accent); text-decoration: underline; word-break: break-word; overflow-wrap: anywhere; }
			.prose blockquote { border-left: 4px solid rgba(var(--black), 0.08); padding: 0.5rem 1rem; color: rgb(var(--gray)); margin: 1rem 0; }
			@media (max-width: 720px){ .prose { padding: 0.75rem; font-size: 0.98rem; } .title h1 { font-size: 1.5rem; } header nav { padding: 0 0.5rem; } }
			@media (min-width: 721px) and (max-width: 1024px){ .prose { padding:1rem 1.25rem; } .title h1 { font-size:2rem; } }
			@media (min-width: 1200px){ .prose { max-width: 900px; } }
			.prose a.button, .prose .button { display:inline-block; padding:0.5rem 0.75rem; border-radius:6px; text-decoration:none; }
		</style>
	</head>
	<body>
		<Header />
		<main>
			<article>
				<div class="hero-image">{heroImage && <img width={1020} height={510} src={heroImage} alt={title} loading="eager" fetchpriority="high" decoding="async" sizes="(max-width: 860px) 100vw, (max-width:1200px) 85vw, 1020px" srcset={`${heroImage} 480w, ${heroImage} 720w, ${heroImage} 1020w`} />}</div>
				<div class="prose">
					<div class="title">
						<div class="date">
							<FormattedDate date={pubDate} />
							{updatedDate && <div class="last-updated-on">Last updated on <FormattedDate date={updatedDate} /></div>}
						</div>
						<h1>{title}</h1>
						{description && <p class="post-description" data-md-desc>{description}</p>}
						<hr />
					</div>
					<slot />
					<BlogComment pageUrl={pageUrl} pageId={pageId} />
				</div>
		</main>
		<Footer />
		<script id="dsq-count-scr" src="//tekhaza.disqus.com/count.js" async></script>
	</body>
</html>
