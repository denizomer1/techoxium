---
/** Disqus universal embed component */
interface Props { pageUrl?: string; pageId?: string; enableCount?: boolean }
const { pageUrl = '', pageId = '', enableCount = false } = Astro.props;
---
<section class="comments-block" aria-labelledby="comments-title" data-state="idle" data-collapsed="false">
  <div class="comments-header-row">
    <h2 id="comments-title" class="comments-title">Yorumlar</h2>
    <button type="button" id="comments-toggle" class="comments-toggle-btn" aria-expanded="true" aria-controls="comments-shell">
      <span class="chevron" aria-hidden="true">▾</span>
      <span class="toggle-label">Gizle</span>
    </button>
  </div>
  <div class="comments-shell" id="comments-shell">
    <div class="comments-skeleton" id="comments-skeleton" aria-hidden="true">
      <div class="sk-row sk-title"></div>
      <div class="sk-row"></div>
      <div class="sk-row"></div>
      <div class="sk-row sk-short"></div>
    </div>
    <div class="comments-actions" id="comments-actions">
      <button type="button" id="load-comments" class="comments-load-btn">Yorumları Yükle</button>
      <button type="button" id="reload-comments" class="comments-reload-btn" hidden>Tekrar Dene</button>
    </div>
    <div id="disqus_thread" class="disqus-thread" role="region" aria-label="Disqus yorumları" tabindex="-1"></div>
  </div>
  <noscript>Lütfen JavaScript'i etkinleştirin: <a href="https://disqus.com/?ref_noscript">yorumları görmek için</a>.</noscript>
  <div class="comments-alt-link" id="comments-alt-link" hidden>
    <a href="https://tekhaza.disqus.com" target="_blank" rel="noopener">Disqus'ta aç</a>
  </div>
</section>
<style>
  .comments-block{background:transparent;color:inherit;padding:0.5rem 0}
  .comments-header-row{display:flex;align-items:center;gap:0.5rem}
  .comments-shell{margin-top:0.75rem}
  .comments-skeleton .sk-row{background:linear-gradient(90deg,rgba(0,0,0,0.06) 0%,rgba(0,0,0,0.02) 50%,rgba(0,0,0,0.06) 100%);height:14px;border-radius:6px;margin:8px 0}
  .comments-block[data-theme="dark"]{color:#e6eef8}
  .comments-block[data-theme="dark"] .comments-skeleton .sk-row{background:linear-gradient(90deg,rgba(255,255,255,0.06) 0%,rgba(255,255,255,0.02) 50%,rgba(255,255,255,0.06) 100%)}
  .comments-block[data-theme="dark"] .comments-load-btn,.comments-block[data-theme="dark"] .comments-reload-btn,.comments-block[data-theme="dark"] .comments-expand-btn{background:rgba(255,255,255,0.06);color:#fff;border:1px solid rgba(255,255,255,0.06)}
  .comments-shell.compact{max-height:420px;overflow:auto}
  .comments-shell.expanded{position:relative}
</style>
<script is:inline>
  var disqus_config = function(){
    try{
      var loc=location;this.page.url=loc.origin+loc.pathname;this.page.identifier=loc.pathname.replace(/\/$/,'')||'index';this.page.title=document.title;this.language='tr';
      var t='light';try{t=localStorage.getItem('theme')||(document.body.classList.contains('dark')?'dark':(matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light'))}catch(_){ }
      this.page.theme=t;
    }catch(_){ }
  };
  (function(){
    if(typeof window==='undefined')return;
    var q=function(s){return document.querySelector(s)};
    var stateEl=q('.comments-block'),shell=q('#comments-shell'),container=q('#disqus_thread'),loadBtn=q('#load-comments'),reloadBtn=q('#reload-comments'),skeleton=q('#comments-skeleton'),altLink=q('#comments-alt-link'),toggleBtn=q('#comments-toggle');
    var loaded=false,loading=false;
    (function(){if(!stateEl)return;var t='light';try{t=localStorage.getItem('theme')||(document.body.classList.contains('dark')?'dark':(matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light'))}catch(_){ }stateEl.setAttribute('data-theme',t)})();
    var applyCollapsed=function(c){if(!shell||!toggleBtn||!stateEl)return;stateEl.setAttribute('data-collapsed',c?'true':'false');toggleBtn.setAttribute('aria-expanded',c?'false':'true');var l=toggleBtn.querySelector('.toggle-label');if(l)l.textContent=c?'Göster':'Gizle';shell.style.maxHeight=c?'0':'';shell.style.overflow=c?'hidden':'';};
    applyCollapsed(localStorage.getItem('commentsCollapsed')==='1');
    toggleBtn&&toggleBtn.addEventListener('click',function(){var coll=stateEl.getAttribute('data-collapsed')==='true';var next=!coll;localStorage.setItem('commentsCollapsed',next?'1':'0');applyCollapsed(next);if(!loaded&&!next)inject();});
    var setState=function(s){stateEl&&stateEl.setAttribute('data-state',s);} , showReload=function(){reloadBtn&&(reloadBtn.hidden=false);loadBtn&&(loadBtn.hidden=true);skeleton&&(skeleton.style.display='none');altLink&&(altLink.hidden=false);setState('error');}, hideSkeleton=function(){skeleton&&(skeleton.style.display='none');loadBtn&&(loadBtn.hidden=true);};
    var inject=function(){if(loaded||loading)return;loading=true;setState('loading');hideSkeleton();if(window.DISQUS){window.DISQUS.reset({reload:true,config:disqus_config});finalize();return;}var s=document.createElement('script');var themeParam=stateEl&&stateEl.getAttribute('data-theme')==='dark'?'?theme=dark':'';s.src='https://tekhaza.disqus.com/embed.js'+themeParam;s.async=true;s.setAttribute('data-timestamp',Date.now());s.onload=finalize;s.onerror=function(){showReload();};(document.head||document.body).appendChild(s);setTimeout(function(){if(!loaded){showReload();}},12000);};
    var finalize=function(){loaded=true;setState('ready');if(innerWidth<=430){shell&&shell.classList.add('compact');addExpandControl();var attempts=0,tmr=setInterval(function(){attempts++;var ifr=q('#disqus_thread iframe');if(!ifr){if(attempts>14)clearInterval(tmr);return;}var maxH=Math.round(innerHeight*0.7);if(ifr.offsetHeight>maxH){ifr.style.height=maxH+'px';ifr.style.maxHeight=maxH+'px';}if(attempts>14)clearInterval(tmr);},500);}};
    if('IntersectionObserver' in window && container){new IntersectionObserver(function(es,io){es.forEach(function(e){if(e.isIntersecting){inject();io.disconnect();}});},{rootMargin:'200px 0px'}).observe(container);} 
    loadBtn&&loadBtn.addEventListener('click',inject);reloadBtn&&reloadBtn.addEventListener('click',function(){loaded=false;loading=false;inject();});
    var addExpandControl=function(){if(document.getElementById('comments-expand-btn'))return;var btn=document.createElement('button');btn.type='button';btn.id='comments-expand-btn';btn.className='comments-expand-btn';btn.setAttribute('aria-expanded','false');btn.setAttribute('aria-controls','disqus_thread');btn.textContent='Tam ekran';btn.onclick=function(){var expanded=btn.getAttribute('aria-expanded')==='true';btn.setAttribute('aria-expanded',expanded?'false':'true');btn.textContent=expanded?'Tam ekran':'Daralt';shell.classList.toggle('expanded',!expanded);if(!expanded){var ifr=q('#disqus_thread iframe');if(ifr){ifr.style.height='';ifr.style.maxHeight='';}scrollTo({top:shell.getBoundingClientRect().top+scrollY-56,behavior:'smooth'});}else{var ifr2=q('#disqus_thread iframe');if(ifr2){var maxH=Math.round(innerHeight*0.7);ifr2.style.height=maxH+'px';ifr2.style.maxHeight=maxH+'px';}}};var wrap=document.createElement('div');wrap.className='comments-expand-wrap';wrap.appendChild(btn);shell.appendChild(wrap);};
  })();
</script>
{ enableCount && <script id="dsq-count-scr" src="//tekhaza.disqus.com/count.js" async></script> }
<noscript>Lütfen JavaScript'i etkinleştirin: <a href="https://disqus.com/?ref_noscript">yorumları görmek için</a>.</noscript>
