---
interface Props {
  pageUrl: string;
  pageId: string;
}
const { pageUrl, pageId } = Astro.props;
---

<div class="embed-wrapper" id="disqus-embed">
  <div id="disqus_thread"></div>
</div>

<script is:inline>
  // Server-provided defaults baked into the page at build time
  const PAGE_URL = ${JSON.stringify(pageUrl)};
  const PAGE_ID = ${JSON.stringify(pageId)};

  const canonicalUrl = () => document.querySelector("link[rel='canonical']")?.href;
  const metaTitle = () => document.querySelector("meta[name='title']")?.content;

  function installDisqus() {
    if (window.__disqus_loaded) return;
    window.__disqus_loaded = true;

    window.disqus_config = function () {
      this.page.url = PAGE_URL && PAGE_URL !== "" ? PAGE_URL : (canonicalUrl() || window.location.href);
      this.page.identifier = PAGE_ID && PAGE_ID !== "" ? PAGE_ID : (metaTitle() || window.location.pathname);
    };

    const d = document;
    const s = d.createElement('script');
    s.src = 'https://tekhaza.disqus.com/embed.js';
    s.async = true;
    s.setAttribute('data-timestamp', String(Date.now()));
    (d.head || d.body).appendChild(s);
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', installDisqus);
  } else {
    installDisqus();
  }
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
