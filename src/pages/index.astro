---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
import { getCollection } from 'astro:content';
import PostCard from '../components/PostCard.astro';

const posts = (await getCollection('blog'))
	.map((p) => ({ ...p, data: { ...p.data, pubDate: new Date(p.data.pubDate) } }))
	.sort((a, b) => Number(b.data.pubDate) - Number(a.data.pubDate))
	.slice(0, 6);
---

<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
					<style>
						.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:1.15rem; list-style:none; margin:0; padding:0; }
						@media (min-width:1400px){ .grid { grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); } }
					</style>
	</head>
	<body>
		<Header />
		<main>
			<h1>Son YazÄ±lar</h1>
			<section>
					<ul class="grid">
						{posts.map((post, i) => (
							<PostCard
								index={i}
								href={`/${post.slug ?? post.id}/`}
								title={post.data.title}
								pubDate={post.data.pubDate}
								heroImage={post.data.heroImage}
								large={i === 0}
							/>
						))}
					</ul>
			</section>
		</main>
		<Footer />
			<script type="module">
				// Staggered entrance for .grid cards using IntersectionObserver
				if (typeof window !== 'undefined') {
					const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
					const grid = document.querySelector('.grid');
					if (grid) {
						if (prefersReduced) {
							grid.classList.add('in-view');
						} else if ('IntersectionObserver' in window) {
							const io = new IntersectionObserver((entries, obs) => {
								entries.forEach(e => {
									if (e.isIntersecting) {
										grid.classList.add('in-view');
										obs.disconnect();
									}
								});
							}, { threshold: 0.08, rootMargin: '0px 0px -8% 0px' });
							io.observe(grid);
						} else {
							grid.classList.add('in-view');
						}
					}
				}
			</script>
	</body>
</html>
