---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';
import PostCard from '../../components/PostCard.astro';
import { t } from '../../i18n/utils';

const locale = 'en';
const rawPosts = await getCollection('blogEn');
const posts = rawPosts
	.map((p) => ({
		...p,
		data: { ...p.data, pubDate: p.data.pubDate instanceof Date ? p.data.pubDate : new Date(p.data.pubDate as any) },
	}))
	.sort((a, b) => Number(b.data.pubDate) - Number(a.data.pubDate));
const [firstPost, ...restPosts] = posts;
---

<html lang={locale}>
	<head>
		<BaseHead title={t(locale, 'site.title')} description={t(locale, 'site.description')} locale={locale} />
		
		<!-- Structured Data for Website -->
		<script type="application/ld+json" set:html={
			JSON.stringify({
				"@context": "https://schema.org",
				"@type": "WebSite",
				"name": "Techoxium",
				"description": t(locale, 'site.description'),
				"url": "https://techoxium.com",
				"publisher": {
					"@type": "Organization",
					"name": "Techoxium",
					"logo": {
						"@type": "ImageObject",
						"url": "https://techoxium.com/logo.png"
					}
				}
			})
		} />
	</head>
	<body>
		<Header locale={locale} />
		<main>
			<h1>{t(locale, 'blog.title')}</h1>
			<section>
				{firstPost && (
					<div class="featured-list">
						<PostCard
							href={`/en/${firstPost.id}/`}
							title={firstPost.data.title}
							description={firstPost.data.description}
							pubDate={firstPost.data.pubDate}
							heroImage={firstPost.data.heroImage}
							large={true}
						/>
					</div>
				)}
				<div class="post-list grid grid-2">
					{restPosts.map((post) => (
						<PostCard
							href={`/en/${post.id}/`}
							title={post.data.title}
							description={post.data.description}
							pubDate={post.data.pubDate}
							heroImage={post.data.heroImage}
						/>
					))}
				</div>
			</section>
		</main>
		<Footer locale={locale} />
	</body>
</html>

<style>
	.featured-list { 
		margin: 0 0 2rem; 
	}
	
	.featured-list .post-card { 
		box-shadow: 0 14px 46px -10px rgba(var(--gray), 25%), 0 8px 22px -8px rgba(var(--gray), 12%); 
	}
</style>